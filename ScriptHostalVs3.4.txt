/*
--LIMPIEZA DE BASE DE DATOS
SELECT 'DROP TABLE '||table_name||' CASCADE CONSTRAINTS;' FROM user_tables;
--Ejecutar resultado de query 
*/


CREATE TABLE tipo_usuario (
    id_tipo	      NUMBER(10) NOT NULL,
    descripcion       VARCHAR2(40) NOT NULL
);
ALTER TABLE tipo_usuario ADD CONSTRAINT tipo_usuario_pk PRIMARY KEY( id_tipo
);



CREATE TABLE usuario (
    id_usuario                NUMBER(10) NOT NULL,
    usuario                   VARCHAR2(20) NOT NULL,
    contrasena                VARCHAR2(10) NOT NULL,
    id_tipo		      number(10) not null
);
ALTER TABLE usuario ADD CONSTRAINT usuario_pk PRIMARY KEY ( id_usuario );

ALTER TABLE usuario
    ADD CONSTRAINT tipo_usuario_fk FOREIGN KEY ( id_tipo )
        REFERENCES tipo_usuario ( id_tipo );


		
CREATE TABLE estado_empleado (
    id_estado	      NUMBER(10) NOT NULL,
    descripcion       VARCHAR2(40) NOT NULL
);
ALTER TABLE estado_empleado ADD CONSTRAINT estado_empleado_pk PRIMARY KEY( id_estado);

CREATE TABLE empleado (
    id_empleado          NUMBER(10) NOT NULL,
    rut_empleado         NUMBER(10) NOT NULL,
	dv_empleado          VARCHAR2(2),
    nombres_empleado     VARCHAR2(40) NOT NULL,
    apellidos_empleado   VARCHAR2(40),
    telefono_empleado    VARCHAR2(20) NOT NULL,
    estado_empleado      NUMBER(10) NOT NULL,
    correo_empleado      VARCHAR2(62) NOT NULL,
    id_usuario	 		NUMBER(10)
);

ALTER TABLE empleado ADD CONSTRAINT empleado_pk PRIMARY KEY ( id_empleado );
CREATE UNIQUE INDEX empleado__idx ON empleado ( id_usuario ASC );

ALTER TABLE empleado
    ADD CONSTRAINT usuario_emleado_fk FOREIGN KEY ( id_usuario )
        REFERENCES usuario ( id_usuario );


		
		
CREATE TABLE empresa (
    id_empresa          NUMBER(10) NOT NULL,
    rut_empresa         NUMBER(10) NOT NULL,
	dv_empresa          VARCHAR2(2),
    nombre_empresa      VARCHAR2(40) NOT NULL,
    direccion_empresa   VARCHAR2(60) NOT NULL,
    giro_empresa        VARCHAR2(100) NOT NULL
);
ALTER TABLE empresa ADD CONSTRAINT empresa_pk PRIMARY KEY ( id_empresa );


CREATE TABLE cliente (
    id_cliente           NUMBER(10) NOT NULL,
	rut_cliente         NUMBER(10) NOT NULL,
	dv_cliente          VARCHAR2(2),
    nombres_cliente       VARCHAR2(40) NOT NULL,
	apellidos_cliente     VARCHAR2(40) NOT NULL,
    telefono_cliente     VARCHAR2(20) NOT NULL,
    correo_cliente       VARCHAR2(62) NOT NULL,
    id_usuario   	     NUMBER(10) NOT NULL,
	id_empresa 			 NUMBER(10) NOT NULL
);

ALTER TABLE cliente ADD CONSTRAINT cliente_pk PRIMARY KEY ( id_cliente );
ALTER TABLE cliente ADD CONSTRAINT usuario_cliente_fk FOREIGN KEY ( id_usuario )
        REFERENCES usuario ( id_usuario );
ALTER TABLE cliente ADD CONSTRAINT empresa_cliente_fk FOREIGN KEY ( id_empresa )
        REFERENCES empresa ( id_empresa );
		
CREATE UNIQUE INDEX cliente__idx ON cliente ( id_usuario ASC );



CREATE TABLE rubro (
    id_rubro       NUMBER(10) NOT NULL,
    descripcion_rubro   VARCHAR2(40) NOT NULL
);
ALTER TABLE rubro ADD CONSTRAINT rubro_pk PRIMARY KEY ( id_rubro );


CREATE TABLE proveedor (
    id_proveedor          NUMBER(10) NOT NULL,
    rut_proveedor         VARCHAR2(10) NOT NULL,
	dv_proveedor            VARCHAR2(2),
    nombres_proveedor     VARCHAR2(40) NOT NULL,
    apellidos_proveedor   VARCHAR2(40),
    telefono_proveedor    VARCHAR2(20) NOT NULL,
	correo_proveedor      VARCHAR2(62) NOT NULL,
    id_rubro        	NUMBER(10) NOT NULL,
	id_usuario 			NUMBER(10) NOT NULL
);
ALTER TABLE proveedor ADD CONSTRAINT proveedor_pk PRIMARY KEY ( id_proveedor );
ALTER TABLE proveedor ADD CONSTRAINT rubro_proveedor_fk FOREIGN KEY ( id_rubro )
        REFERENCES rubro ( id_rubro );
ALTER TABLE proveedor ADD CONSTRAINT usuario_proveedor_fk FOREIGN KEY ( id_usuario )
        REFERENCES usuario ( id_usuario );
CREATE UNIQUE INDEX proveedor__idx ON proveedor ( id_usuario ASC );

		
CREATE TABLE trabajador (
	id_trabajador		  NUMBER(10) NOT NULL,	
    rut_trabajador        VARCHAR2(10) NOT NULL,
    dv_trabajador         VARCHAR2(2),
    nombre_trabajador     VARCHAR2(40) NOT NULL,
    apellido_trabajador   VARCHAR2(40)NOT NULL,
    telefono              VARCHAR2(20),
    id_empresa    	  	  NUMBER(10) NOT NULL
);
ALTER TABLE trabajador ADD CONSTRAINT trabajador_pk PRIMARY KEY ( id_trabajador );
ALTER TABLE trabajador ADD CONSTRAINT empresa_proveedor_fk FOREIGN KEY ( id_empresa )
        REFERENCES empresa ( id_empresa );






---- HASTA ACA REVISE PARA CREAR USUARIOS ....


CREATE TABLE comedor (
    id_comedor                  number(10) NOT NULL,
    nombre                      varchar2(20) NOT NULL,
    id_servicio   number(10) NOT NULL,
    id_orden    number(10) NOT NULL
);
		
CREATE TABLE calendario_minuta (
    id_calendario      NUMBER(10) NOT NULL,
    fecha_inicio       DATE NOT NULL,
    fecha_fin          DATE NOT NULL,
    id_minuta   NUMBER(10) NOT NULL
);

ALTER TABLE calendario_minuta ADD CONSTRAINT calendario_minuta_pk PRIMARY KEY ( 
id_calendario );

ALTER TABLE comedor ADD CONSTRAINT comedor_pk PRIMARY KEY ( id_comedor );

CREATE TABLE detalle_minuta (
    id_detalle         NUMBER(10) NOT NULL,
    id_minuta   NUMBER(10) NOT NULL
);

ALTER TABLE detalle_minuta ADD CONSTRAINT detalle_minuta_pk PRIMARY KEY 
(id_minuta );


CREATE TABLE estado_habitacion (
    id_estado                  NUMBER(10) NOT NULL,
    estado                     NUMBER(10) NOT NULL,
    id_habitacion   		VARCHAR2(5) NOT NULL
);

CREATE UNIQUE INDEX estado_habitacion__idx ON
    estado_habitacion ( id_habitacion ASC );

ALTER TABLE estado_habitacion ADD CONSTRAINT estado_habitacion_pk PRIMARY KEY ( 
id_estado );

CREATE TABLE factura (
    id_factura   number(10) NOT NULL,
    precio       NUMBER(10) NOT NULL
);

ALTER TABLE factura ADD CONSTRAINT factura_pk PRIMARY KEY ( id_factura );

CREATE TABLE familia (
    id_familia       NUMBER(10) NOT NULL,
    nombre_familia   VARCHAR2(15) NOT NULL,
    id_stock   number(10) NOT NULL
);

ALTER TABLE familia ADD CONSTRAINT familia_pk PRIMARY KEY ( id_familia );

CREATE TABLE habitacion (
    id_habitacion                 number(10) NOT NULL,
    numero_habitacion             NUMBER(10) NOT NULL,
    disponibilidad_habitacion     NUMBER(10) NOT NULL,
    accesorios_habitacion         VARCHAR2(30),
    id_tipo       		  number(10) NOT NULL,
    id_orden      		  number(10) NOT NULL,
    id_estado   		  NUMBER(10) NOT NULL
);

CREATE UNIQUE INDEX habitacion__idx ON
    habitacion ( id_estado ASC );

ALTER TABLE habitacion ADD CONSTRAINT habitacion_pk PRIMARY KEY ( id_habitacion 
);

CREATE TABLE huesped (
    id_ficha        number(10) NOT NULL,
    fecha_ingreso   DATE NOT NULL,
    fecha_salida    DATE NOT NULL,
    estado          CHAR(1) NOT NULL
);

ALTER TABLE huesped ADD CONSTRAINT huesped_pk PRIMARY KEY ( id_ficha );

CREATE TABLE minuta (
    id_minuta           NUMBER(10) NOT NULL,  
    id_calendario       NUMBER(10) NOT NULL,
    id_servicio         number(10) NOT NULL
);

CREATE UNIQUE INDEX minuta__idx ON
    minuta ( id_calendario ASC );

ALTER TABLE minuta ADD CONSTRAINT minuta_pk PRIMARY KEY ( id_minuta );

CREATE TABLE orden_de_compra (
    id_orden                    number(10) NOT NULL,
    fecha_orden                    DATE NOT NULL,
    id_factura          	number(10) NOT NULL,
    detalle_orden                VARCHAR2(30) NOT NULL,
    precio_orden                   NUMBER(10),
    id_trabajador   		NUMBER(10) NOT NULL
);

ALTER TABLE orden_de_compra ADD CONSTRAINT orden_de_compra_pk PRIMARY KEY ( 
id_orden );

CREATE TABLE orden_de_pedido (
    id_orden           	number(10) NOT NULL,
    detalle                  VARCHAR2(100) NOT NULL,
    id_proveedor	     NUMBER(10) NOT NULL,
    id_empleado     NUMBER(10) NOT NULL
);

ALTER TABLE orden_de_pedido ADD CONSTRAINT orden_de_pedido_pk PRIMARY KEY ( 
id_orden );

CREATE TABLE producto (
    id_producto                       NUMBER(10) NOT NULL,
    nombre_producto                   VARCHAR2(15) NOT NULL,
    fecha_vencimiento                 DATE NOT NULL,
    id_stock                    	number(10) NOT NULL,
    id_detalle                        NUMBER(10) NOT NULL, 
    id_minuta                         NUMBER(10) NOT NULL
);

ALTER TABLE producto ADD CONSTRAINT producto_pk PRIMARY KEY ( id_producto );




CREATE TABLE stock (
    id_stock       number(10) NOT NULL,
    stock          NUMBER(10) NOT NULL,
    codigo_barra   VARCHAR2(199) NOT NULL,
    id_orden       NUMBER(10) NOT NULL,
    id_proveedor number(10) NOT NULL
);

alter table stock
add constraint id_orden_fk foreign key (id_orden)
references orden_de_pedido (id_orden);

ALTER TABLE stock ADD CONSTRAINT stock_pk PRIMARY KEY ( id_stock );

CREATE TABLE tipo_habitacion (
    id_tipo         number(10) NOT NULL,
    cant_camas      NUMBER(10) NOT NULL,
    precio          NUMBER(10) NOT NULL,
    banio_privado   NUMBER(10) NOT NULL,
    tipo_cama       VARCHAR2(15) NOT NULL
);

ALTER TABLE tipo_habitacion ADD CONSTRAINT tipo_habitacion_pk PRIMARY KEY ( 
id_tipo );

CREATE TABLE tipo_producto (
    id_tipo          NUMBER(10) NOT NULL,
    nombre_tipo      VARCHAR2(15) NOT NULL,
    id_stock   number(10) NOT NULL
);

ALTER TABLE tipo_producto ADD CONSTRAINT tipo_producto_pk PRIMARY KEY ( id_tipo 
);

CREATE TABLE tipo_servicio (
    id_servicio   number(10) NOT NULL,
    descripcion   VARCHAR2(30) NOT NULL,
    precio        NUMBER(10) NOT NULL
);

ALTER TABLE tipo_servicio ADD CONSTRAINT tipo_servicio_pk PRIMARY KEY ( 
id_servicio );


ALTER TABLE comedor
    ADD CONSTRAINT comedor_orden_de_compra_fk FOREIGN KEY (id_orden )
        REFERENCES orden_de_compra ( id_orden );

ALTER TABLE comedor
    ADD CONSTRAINT comedor_tipo_servicio_fk FOREIGN KEY (id_servicio )
        REFERENCES tipo_servicio ( id_servicio );

ALTER TABLE detalle_minuta
    ADD CONSTRAINT detalle_minuta_minuta_fk FOREIGN KEY ( id_minuta )
        REFERENCES minuta ( id_minuta );

ALTER TABLE familia
    ADD CONSTRAINT familia_stock_fk FOREIGN KEY ( id_stock )
        REFERENCES stock ( id_stock );

ALTER TABLE habitacion
    ADD CONSTRAINT habitacion_orden_de_compra_fk FOREIGN KEY (id_orden )
        REFERENCES orden_de_compra ( id_orden );

ALTER TABLE habitacion
    ADD CONSTRAINT habitacion_tipo_habitacion_fk FOREIGN KEY (id_tipo )
        REFERENCES tipo_habitacion ( id_tipo );

ALTER TABLE minuta
    ADD CONSTRAINT minuta_tipo_servicio_fk FOREIGN KEY ( id_servicio )
        REFERENCES tipo_servicio ( id_servicio );

ALTER TABLE orden_de_compra
    ADD CONSTRAINT orden_de_compra_factura_fk FOREIGN KEY ( id_factura )
        REFERENCES factura ( id_factura );

ALTER TABLE orden_de_compra
    ADD CONSTRAINT orden_de_compra_trabajador_fk FOREIGN KEY (id_trabajador )
        REFERENCES trabajador ( id_trabajador );

ALTER TABLE orden_de_pedido
    ADD CONSTRAINT orden_de_pedido_empleado_fk FOREIGN KEY (id_empleado )
        REFERENCES empleado ( id_empleado );




ALTER TABLE producto
    ADD CONSTRAINT producto_stock_fk FOREIGN KEY ( id_stock )
        REFERENCES stock ( id_stock );

ALTER TABLE tipo_producto
    ADD CONSTRAINT tipo_producto_fk FOREIGN KEY ( id_stock )
        REFERENCES stock  ( id_stock );
alter table stock
add constraint id_proveedor_fk foreign key (id_proveedor)
references proveedor (id_proveedor);


alter table habitacion
add constraint id_estado_fk foreign key (id_estado)
references estado_habitacion (id_estado);

alter table calendario_minuta
add constraint id_calendario_fk foreign key (id_minuta)
references minuta (id_minuta);

-- ESTE DOCUMENTO SE VEE MEJOR EN SQL DEVELOPER --- Y ES PARA POBLAR DATOS ANTES DE PROGRAMAR

--select  from TABS;

--select * from TIPO_USUARIO;
insert into TIPO_USUARIO (ID_TIPO,DESCRIPCION) values (1,'Administrador');
insert into TIPO_USUARIO (ID_TIPO,DESCRIPCION) values (2,'Empleado');
insert into TIPO_USUARIO (ID_TIPO,DESCRIPCION) values (3,'Cliente');
insert into TIPO_USUARIO (ID_TIPO,DESCRIPCION) values (4,'Proveedor');

--select * from USUARIO;
insert into USUARIO (ID_USUARIO,USUARIO,CONTRASENA,ID_TIPO) values (1,'admin','admin',1);
insert into USUARIO (ID_USUARIO,USUARIO,CONTRASENA,ID_TIPO) values (2,'cliente1','cliente1',3);


--select * from estado_empleado;
insert into estado_empleado (ID_ESTADO,DESCRIPCION) values (1,'Contratado');
insert into estado_empleado (ID_ESTADO,DESCRIPCION) values (2,'Despedido');
insert into estado_empleado (ID_ESTADO,DESCRIPCION) values (3,'Temporal');

--select * from EMPLEADO;
insert into EMPLEADO (ID_EMPLEADO,RUT_EMPLEADO,DV_EMPLEADO,NOMBRES_EMPLEADO,APELLIDOS_EMPLEADO,TELEFONO_EMPLEADO,ESTADO_EMPLEADO,CORREO_EMPLEADO,ID_USUARIO)
values (1,1,'9','Administrador','Dueño','123456789',1,'correo@hostalclarita.cl',1);


--select * from EMPRESA;
insert into EMPRESA (ID_EMPRESA,RUT_EMPRESA,DV_EMPRESA,NOMBRE_EMPRESA,DIRECCION_EMPRESA,GIRO_EMPRESA)
values (1,1,'7','Empresa 1','Campos de hielo 1584, Maipu','Informatica');


--select * from CLIENTE;
insert into CLIENTE (ID_CLIENTE,RUT_CLIENTE,DV_CLIENTE,NOMBRES_CLIENTE,APELLIDOS_CLIENTE,TELEFONO_CLIENTE,
CORREO_CLIENTE,ID_USUARIO,ID_EMPRESA)
values (1,1,'8','Cliente 1','cliente1','123456789','correo@cliente1.cl',2,1);


--select * from TRABAJADOR;
insert into TRABAJADOR (ID_TRABAJADOR,RUT_TRABAJADOR,DV_TRABAJADOR,NOMBRE_TRABAJADOR,APELLIDO_TRABAJADOR,TELEFONO,ID_EMPRESA)
values ('1',1,'9','Trabajador1 e1','trabajador1 e1','12345678',1);




commit;